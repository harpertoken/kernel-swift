#!/bin/bash

# commit-msg hook to enforce conventional commit standards
# - Starts with type: (feat, fix, docs, style, refactor, test, chore, etc.)
# - First line lowercase and ≤60 characters

COMMIT_MSG_FILE=$1
COMMIT_MSG=$(head -n1 "$COMMIT_MSG_FILE")

# Check if starts with type:
if ! echo "$COMMIT_MSG" | grep -qE '^(feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert)(\(.+\))?: '; then
    echo "Error: Commit message must start with a conventional commit type (e.g., feat:, fix:)"
    exit 1
fi

# Check if first line is lowercase
if [ "$COMMIT_MSG" != "$(echo "$COMMIT_MSG" | tr '[:upper:]' '[:lower:]')" ]; then
    echo "Error: Commit message first line must be lowercase"
    exit 1
fi

# Check length ≤60
if [ ${#COMMIT_MSG} -gt 60 ]; then
    echo "Error: Commit message first line must be ≤60 characters"
    exit 1
fi

exit 0